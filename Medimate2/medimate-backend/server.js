// Import required modules
const express = require('express');
const bodyParser = require('body-parser');
const { GoogleGenerativeAI } = require("@google/generative-ai");
const cors = require('cors');
const axios = require('axios');

const app = express();
app.use(cors());
// Middleware to parse JSON request bodies
app.use(bodyParser.json());

// Flash LLM Utility
const genAI = new GoogleGenerativeAI("AIzaSyCFtiP0M8maQIXQiECmNI5FqleVNIr0Lf8");
const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

const getFlashLLMResponse = async (message, language) => {
    const prompt = `Respond directly to the user's query without any formatting or additional structure. User's query: \"${message}\" in language: \"${language}\"`;

    const response = await model.generateContent(prompt);
    console.log(response.response.candidates[0].content.parts[0].text);
    return response.response.candidates[0].content.parts[0].text;
};

// Check if the query is medical-related
const isMedicalQuery = (message) => {
    const medicalKeywords = [
        "health", "hospital","first aid","bleeding", "what do i do","what should i do","what to do","migraine","headache","blood loss","blood","emergency response", "CPR", "bleeding control", "choking", "burns", "fractures", "cuts", "wounds", "sprains", "strains", "bandages", "splints", "dressing wounds", "shock treatment", "poisoning", "snake bite", "insect bite", "heat stroke", "frostbite", "hypothermia", "seizures", "fainting", "cardiac arrest", "heart attack", "resuscitation", "airway management", "recovery position", "head injury", "spinal injury", "allergic reaction", "anaphylaxis", "basic life support", "automated external defibrillator", "AED", "pulse check", "breathing assessment", "wound cleaning", "antiseptic", "tourniquet", "immobilization", "pain relief", "injury care", "trauma response", "accident care", "safety protocols", "dehydration", "heat exhaustion", "sunburn", "nosebleeds", "eye injury", "dental injury", "drowning", "burns classification", "chemical burns", "electrical burns", "scalds", "blister care", "emergency kit", "first aid manual", "stretcher usage", "dressing changes", "infection prevention", "safety gloves", "cold compress", "warm compress", "band-aid", "antiseptic cream", "disinfectant", "adhesive tape", "gauze pads", "cotton balls", "tweezers", "scissors", "emergency blankets", "hydration", "overexertion", "hyperventilation", "panic attack", "vital signs", "blood pressure check", "pulse oximeter", "fever management", "breathing difficulties", "asthma attack", "hyperglycemia", "hypoglycemia", "diabetic emergencies", "seizure management", "epilepsy first aid", "stroke identification", "stroke management", "emergency numbers", "rapid response", "safety measures", "risk assessment", "bystander assistance", "emergency triage", "patient stabilization", "casualty care", "life-saving techniques", "environmental emergencies", "safety hazards", "protective equipment", "health emergencies", "critical care", "rapid intervention", "self-care tips", "risk prevention", "safety education", "quick response", "medical supplies", "emergency preparedness", "disaster response", "safety drills", "injury prevention", "medical support", "triage process", "health and safety", "basic training", "trauma management", "emergency resources", "injury stabilization", "infection control", "heat cramps", "water safety", "road accident care", "collision response", "trauma kit", "splinting techniques", "bandaging methods", "wound closure", "antiseptic wipes", "painkillers", "ibuprofen", "paracetamol", "safety goggles", "face shield", "evacuation plan", "emergency evacuation", "crowd control", "fire safety", "chemical safety", "accident prevention", "first responder", "emergency care", "survival tips", "disaster readiness", "emergency first aid", "patient care", "first aid box", "emergency checklist", "first aid certification", "breathing emergency", "airway clearance", "Heimlich maneuver", "compression-only CPR", "rescue breathing", "chest compressions", "bleeding wounds", "lacerations", "abrasions", "puncture wounds", "animal bite", "tick bite", "marine stings", "jellyfish sting", "emergency hydration", "oral rehydration solution", "heat emergencies", "hypothermia treatment", "frostbite care", "cold exposure", "electrocution care", "spinal precautions", "head immobilizer", "neck brace", "emergency blanket", "triage training", "medical emergency app", "quick help", "emergency guidance", "safety information", "self-help first aid", "basic wound care", "minor burns", "serious burns", "infection risk", "safety training", "home safety", "office safety", "public safety", "emergency scenarios", "lifesaving equipment", "accident scenarios", "emergency response guide", "medicine", "doctor", "treatment", "symptom", "disease", "clinic", "pharmacy", "injury", "wound", "cut", "pain", "fever", "cold", "flu", "infection", "allergy", "rash", "burn", "fracture", "headache", "stomachache", "nausea", "vomiting", "diarrhea", "constipation", "bleeding", "sprain", "bruise", "cough", "sore throat", "dizziness", "asthma", "diabetes", "cancer", "hypertension", "blood pressure", "cholesterol", "arthritis", "cardiac", "heart", "lungs", "kidney", "liver", "mental health", "depression", "anxiety", "therapy", "rehabilitation", "surgery", "operation", "prescription", "vaccine", "immunization", "emergency", "urgent care","salud","hospital","primeros auxilios","sangrado","qué hago","qué debo hacer","qué hacer","migraña","dolor de cabeza","pérdida de sangre","sangre","respuesta de emergencia","RCP","control de sangrado","asfixia","quemaduras","fracturas","cortes","heridas","esguinces","distensiones","vendas","férulas","curación de heridas","tratamiento de choque","envenenamiento","mordedura de serpiente","picadura de insecto","golpe de calor","congelación","hipotermia","convulsiones","desmayo","paro cardíaco","ataque al corazón","resucitación","manejo de vías respiratorias","posición de recuperación","lesión en la cabeza","lesión de la columna vertebral","reacción alérgica","anafilaxia","soporte vital básico","desfibrilador externo automatizado","DAE","verificación de pulso","evaluación de respiración","limpieza de heridas","antiséptico","torniquete","inmovilización","alivio del dolor","cuidado de lesiones","respuesta al trauma","atención al accidente","protocolos de seguridad","deshidratación","agotamiento por calor","quemadura solar","hemorragias nasales","lesión ocular","lesión dental","ahogamiento","clasificación de quemaduras","quemaduras químicas","quemaduras eléctricas","escaldaduras","cuidado de ampollas","kit de emergencia","manual de primeros auxilios","uso de camilla","cambios de apósitos","prevención de infecciones","guantes de seguridad","compresa fría","compresa caliente","tirita","crema antiséptica","desinfectante","cinta adhesiva","almohadillas de gasa","bolas de algodón","pinzas","tijeras","mantas de emergencia","hidratación","esfuerzo excesivo","hiperventilación","ataque de pánico","signos vitales","control de presión arterial","oxímetro de pulso","manejo de fiebre","dificultades respiratorias","ataque de asma","hiperglucemia","hipoglucemia","emergencias diabéticas","manejo de convulsiones","primeros auxilios para la epilepsia","identificación de derrames","manejo de derrames","números de emergencia","respuesta rápida","medidas de seguridad","evaluación de riesgos","asistencia de espectadores","triaje de emergencia","estabilización del paciente","atención a víctimas","técnicas para salvar vidas","emergencias ambientales","peligros de seguridad","equipo protector","emergencias de salud","cuidados críticos","intervención rápida","consejos de autocuidado","prevención de riesgos","educación en seguridad","respuesta rápida","suministros médicos","preparación para emergencias","respuesta a desastres","simulacros de seguridad","prevención de lesiones","apoyo médico","proceso de triaje","salud y seguridad","entrenamiento básico","manejo del trauma","recursos de emergencia","estabilización de lesiones","control de infecciones","calambres por calor","seguridad en el agua","atención a accidentes viales","respuesta a colisiones","kit de trauma","técnicas de férula","métodos de vendaje","cierre de heridas","toallitas antisépticas","analgésicos","ibuprofeno","paracetamol","gafas de seguridad","escudo facial","plan de evacuación","evacuación de emergencia","control de multitudes","seguridad contra incendios","seguridad química","prevención de accidentes","primer respondiente","cuidado de emergencia","consejos de supervivencia","preparación para desastres","primeros auxilios de emergencia","cuidado del paciente","caja de primeros auxilios","lista de verificación de emergencias","certificación de primeros auxilios","emergencia respiratoria","limpieza de vías respiratorias","maniobra de Heimlich","RCP solo compresiones","respiración de rescate","compresiones torácicas","heridas sangrantes","laceraciones","abrasiones","heridas punzantes","mordedura de animal","picadura de garrapata","picaduras marinas","picadura de medusa","hidratación de emergencia","solución de rehidratación oral","emergencias por calor","tratamiento de hipotermia","cuidado de congelación","exposición al frío","cuidado de electrocución","precauciones espinales","inmovilizador de cabeza","collarín","manta de emergencia","entrenamiento de triaje","app de emergencia médica","ayuda rápida","guía de emergencia","información de seguridad","primeros auxilios de autoayuda","cuidado básico de heridas","quemaduras menores","quemaduras graves","riesgo de infección","entrenamiento en seguridad","seguridad en el hogar","seguridad en la oficina","seguridad pública","escenarios de emergencia","equipos salvavidas","escenarios de accidentes","guía de respuesta de emergencia","medicina","médico","tratamiento","síntoma","enfermedad","clínica","farmacia","lesión","herida","corte","dolor","fiebre","resfriado","gripe","infección","alergia","erupción","quemadura","fractura","dolor de cabeza","dolor de estómago","náuseas","vómitos","diarrea","estreñimiento","sangrado","esguince","moretón","tos","dolor de garganta","mareos","asma","diabetes","cáncer","hipertensión","presión arterial","colesterol","artritis","cardíaco","corazón","pulmones","riñón","hígado","salud mental","depresión","ansiedad","terapia","rehabilitación","cirugía","operación","receta médica","vacuna","inmunización","emergencia","atención urgente","santé","hôpital","premiers secours","saignement","que faire","que dois-je faire","que faut-il faire","migraine","mal de tête","perte de sang","sang","réponse d'urgence","RCP","contrôle des saignements","étouffement","brûlures","fractures","coupures","blessures","entorses","foulures","bandages","attelles","pansements","traitement de choc","empoisonnement","morsure de serpent","piqûre d'insecte","coup de chaleur","gelures","hypothermie","convulsions","évanouissement","arrêt cardiaque","crise cardiaque","réanimation","gestion des voies respiratoires","position de récupération","blessure à la tête","blessure à la colonne vertébrale","réaction allergique","anaphylaxie","soutien vital de base","défibrillateur externe automatisé","DEA","contrôle du pouls","évaluation de la respiration","nettoyage des plaies","antiseptique","garrot","immobilisation","soulagement de la douleur","soins des blessures","réponse au traumatisme","soins en cas d'accident","protocoles de sécurité","déshydratation","épuisement dû à la chaleur","coup de soleil","saignements de nez","blessure aux yeux","blessure dentaire","noyade","classification des brûlures","brûlures chimiques","brûlures électriques","échaudures","soins des ampoules","kit d'urgence","manuel de premiers secours","utilisation de brancards","changement de pansements","prévention des infections","gants de sécurité","compresse froide","compresse chaude","pansement","crème antiseptique","désinfectant","ruban adhésif","compresses de gaze","boules de coton","pince à épiler","ciseaux","couvertures d'urgence","hydratation","surmenage","hyperventilation","crise de panique","signes vitaux","contrôle de la tension artérielle","oxymètre de pouls","gestion de la fièvre","difficultés respiratoires","crise d'asthme","hyperglycémie","hypoglycémie","urgences diabétiques","prise en charge des convulsions","premiers secours en cas d'épilepsie","identification des AVC","prise en charge des AVC","numéros d'urgence","réponse rapide","mesures de sécurité","évaluation des risques","assistance des témoins","triage d'urgence","stabilisation du patient","soins aux victimes","techniques de sauvetage","urgences environnementales","risques pour la sécurité","équipements de protection","urgences médicales","soins critiques","intervention rapide","conseils d'auto-soins","prévention des risques","éducation à la sécurité","réponse rapide","fournitures médicales","préparation aux urgences","réponse aux catastrophes","exercices de sécurité","prévention des blessures","soutien médical","processus de triage","santé et sécurité","formation de base","prise en charge des traumatismes","ressources d'urgence","stabilisation des blessures","contrôle des infections","crampes de chaleur","sécurité aquatique","soins des accidents de la route","réponse aux collisions","kit de traumatologie","techniques d'attelle","méthodes de bandage","fermeture des plaies","lingettes antiseptiques","antalgiques","ibuprofène","paracétamol","lunettes de sécurité","visière","plan d'évacuation","évacuation d'urgence","contrôle des foules","sécurité incendie","sécurité chimique","prévention des accidents","premier intervenant","soins d'urgence","conseils de survie","préparation aux catastrophes","premiers secours d'urgence","soins aux patients","trousse de premiers secours","liste de contrôle d'urgence","certification de premiers secours","urgence respiratoire","dégagement des voies respiratoires","manœuvre de Heimlich","RCP uniquement avec compressions","respiration artificielle","compressions thoraciques","plaies saignantes","lacérations","abrasions","plaies perforantes","morsure d'animal","piqûre de tique","piqûres marines","piqûre de méduse","hydratation d'urgence","solution de réhydratation orale","urgences liées à la chaleur","traitement de l'hypothermie","soins des engelures","exposition au froid","prise en charge des électrocutions","précautions rachidiennes","immobilisateur de tête","minerve","couverture d'urgence","formation au triage","application médicale d'urgence","aide rapide","guide d'urgence","informations de sécurité","premiers secours autodidactes","soins de plaies de base","brûlures mineures","brûlures graves","risque d'infection","formation à la sécurité","sécurité à domicile","sécurité au bureau","sécurité publique","scénarios d'urgence","équipements de sauvetage","scénarios d'accidents","guide de réponse d'urgence","médicament","médecin","traitement","symptôme","maladie","clinique","pharmacie","blessure","plaie","coupure","douleur","fièvre","rhume","grippe","infection","allergie","éruption","brûlure","fracture","maux de tête","maux d'estomac","nausées","vomissements","diarrhée","constipation","saignement","entorse","ecchymose","toux","mal de gorge","vertiges","asthme","diabète","cancer","hypertension","pression artérielle","cholestérol","arthrite","cardiaque","cœur","poumons","reins","foie","santé mentale","dépression","anxiété","thérapie","réhabilitation","chirurgie","opération","ordonnance","vaccin","immunisation","urgence","soins urgents”,कम्प्रेशन सीपीआर","रेस्क्यू ब्रीदिंग","चेस्ट कम्प्रेशन","खून बहता घाव","कटने के निशान","खरोच","घुसा हुआ घाव","जानवर का काटना","कीड़े का काटना","पानी में जहर","जेलीफिश का डंक","आपातकालीन हाइड्रेशन","ओआरएस समाधान","गर्मी के आपातकाल","हाइपोथर्मिया उपचार","शीतदंश देखभाल","ठंडा एक्सपोजर","इलेक्ट्रोक्यूशन देखभाल","रीढ़ सुरक्षा","हेड इममॉबिलाइजर","नेक कॉलर","आपातकालीन ब्लैंकेट","ट्रायेज प्रशिक्षण","आपातकालीन ऐप","त्वरित मदद","आपातकालीन गाइड","सुरक्षा जानकारी","स्वयं सहायता प्राथमिक चिकित्सा","मामूली चोट","गंभीर जलन","संक्रमण खतरा","सुरक्षा प्रशिक्षण","घर की सुरक्षा","ऑफिस सुरक्षा","सार्वजनिक सुरक्षा","आपातकालीन परिस्थितियां","जीवनरक्षक उपकरण","दुर्घटना स्थितियां","आपातकालीन प्रतिक्रिया गाइड","दवा","डॉक्टर","इलाज","लक्षण","बीमारी","क्लीनिक","फार्मेसी","चोट","घाव","कटाव","दर्द","बुखार","जुकाम","फ्लू","संक्रमण","एलर्जी","फोड़ा","जलन","हड्डी टूटना","सिरदर्द","पेट दर्द","उल्टी","दस्त","कब्ज","खून","मोड़","नीला निशान","खांसी","गले में दर्द","चक्कर आना","अस्थमा","डायबिटीज","कैंसर","ब्लड प्रेशर","कोलेस्ट्रॉल","गठिया","दिल","हृदय","फेफड़े","गुर्दा","लीवर","मानसिक स्वास्थ्य","डिप्रेशन","चिंता","थैरेपी","रिहैबिलिटेशन","सर्जरी","ऑपरेशन","प्रिस्क्रिप्शन","टीका","प्रतिरक्षण","आपातकालीन","तत्काल देखभाल","Gesundheit","Krankenhaus","Erste Hilfe","Blutungen","Was soll ich tun","Was mache ich","Was zu tun","Migräne","Kopfschmerzen","Blutverlust","Blut","Notfallreaktion","HLW","Blutstillung","Erstickung","Verbrennungen","Brüche","Schnitte","Wunden","Verstauchungen","Zerrungen","Verbände","Schienen","Wundversorgung","Schockbehandlung","Vergiftung","Schlangenbiss","Insektenstich","Hitzschlag","Erfrierungen","Unterkühlung","Krampfanfälle","Ohnmacht","Herzstillstand","Herzinfarkt","Wiederbelebung","Atemwegsmanagement","Erholungsposition","Kopfverletzung","Rückenmarksverletzung","allergische Reaktion","Anaphylaxie","Basislebenserhaltung","automatisierter externer Defibrillator","AED","Pulskontrolle","Atemkontrolle","Wundreinigung","Antiseptikum","Tourniquet","Immobilisierung","Schmerzlinderung","Verletzungsversorgung","Traumareaktion","Unfallversorgung","Sicherheitsprotokolle","Dehydrierung","Hitzemüdigkeit","Sonnenbrand","Nasenbluten","Augenverletzung","Zahnverletzung","Ertrinken","Verbrennungsklassifikation","Chemische Verbrennungen","Elektrische Verbrennungen","Verbrühungen","Blasenpflege","Notfallausrüstung","Erste-Hilfe-Handbuch","Tragenutzung","Verbandswechsel","Infektionsprävention","Sicherheits-Handschuhe","Kühlkompresse","Wärmepackung","Pflaster","antiseptische Creme","Desinfektionsmittel","Klebeband","Gaze-Pads","Wattebällchen","Pinzette","Schere","Notfalldecke","Hydratation","Überanstrengung","Hyperventilation","Panikattacke","Vitalzeichen","Blutdruckmessung","Pulsoximeter","Fiebermanagement","Atembeschwerden","Asthmaanfall","Hyperglykämie","Hypoglykämie","Diabetische Notfälle","Krampfanfall-Management","Epilepsie-Erste Hilfe","Schlaganfall-Erkennung","Schlaganfall-Management","Notrufnummern","schnelle Reaktion","Sicherheitsmaßnahmen","Risikobewertung","Helfende Zeugen","Notfalltriage","Patientenstabilisierung","Verletztenversorgung","lebensrettende Techniken","Umweltnotfälle","Sicherheitsgefahren","Schutzausrüstung","medizinische Notfälle","intensivpflege","schnelles Eingreifen","Selbsthilfe-Tipps","Risikoprävention","Sicherheitsbildung","Notfallbereitschaft","medizinische Versorgung","Notfallressourcen","Verletzungsstabilisierung","Infektionskontrolle","Hitzekrämpfe","Wassersicherheit","Straßenunfallversorgung","Kollisionsreaktion","Trauma-Kit","Schienungstechniken","Verbandmethoden","Wundverschluss","antiseptische Tücher","Schmerzmittel","Ibuprofen","Paracetamol","Schutzbrille","Gesichtsschutz","Evakuierungsplan","Notfallevakuierung","Menschenmengen-Kontrolle","Brandschutz","Chemikaliensicherheit","Unfallverhütung","Ersthelfer","Notfallversorgung","Überlebenstipps","Katastrophenvorbereitung","Notfall-Erste Hilfe","Patientenpflege","Erste-Hilfe-Kasten","Notfallcheckliste","Erste-Hilfe-Zertifizierung","Atemnotfälle","Atemwegsreinigung","Heimlich-Manöver","Kompressions-CPR","Rettungsatmung","Brustkompressionen","blutende Wunden","Schnittwunden","Schürfwunden","Stichwunden","Tierbiss","Zeckenbiss","Meeresstiche","Quallenstiche","Notfallhydratation","orale Rehydrierungslösung","Hitzebedingte Notfälle","Unterkühlung Behandlung","Erfrierungspflege","Kälteexposition","Stromschlagversorgung","Wirbelsäulenschutz","Kopfstütze","Nackenstütze","Notfalldecke","Triage-Training","medizinische Notfall-App","schnelle Hilfe","Notfallanleitung","Sicherheitsinformationen","Selbsthilfe-Erste Hilfe","kleine Verletzungen","ernsthafte Verbrennungen","Infektionsrisiko","Sicherheitstraining","Haussicherheit","Bürosicherheit","öffentliche Sicherheit","Notfallszenarien","lebensrettende Ausrüstung","Unfallszenarien","Notfallreaktionshandbuch","Medikamente","Arzt","Behandlung","Symptome","Krankheit","Klinik","Apotheke","Verletzung","Wunde","Schnitt","Schmerzen","Fieber","Erkältung","Grippe","Infektion","Allergie","Ausschlag","Verbrennung","Knochenbruch","Kopfschmerzen","Bauchschmerzen","Übelkeit","Erbrechen","Durchfall","Verstopfung","Blutungen","Verstauchung","Prellung","Husten","Halsschmerzen","Schwindel","Asthma","Diabetes","Krebs","Blutdruck","Cholesterin","Arthritis","Herz","Lunge","Niere","Leber","psychische Gesundheit","Depression","Angst","Therapie","Rehabilitation","Operation","Verschreibung","Impfstoff","Impfung","Notfall","Notfallversorgung","健康","医院","急救","流血","我该怎么办","该做什么","头痛","偏头痛","失血","血液","紧急响应","心肺复苏","止血","窒息","烧伤","骨折","割伤","伤口","扭伤","拉伤","绷带","夹板","伤口处理","休克处理","中毒","蛇咬","昆虫叮咬","中暑","冻伤","体温过低","癫痫发作","昏厥","心脏骤停","心脏病发作","复苏","气道管理","恢复体位","头部受伤","脊柱受伤","过敏反应","过敏性休克","基础生命支持","自动体外除颤器","脉搏检查","呼吸评估","伤口清理","消毒液","止血带","固定","止痛","创伤处理","事故护理","安全协议","脱水","中暑","晒伤","鼻血","眼外伤","牙外伤","溺水","烧伤分级","化学烧伤","电击伤","烫伤","水泡护理","急救包","急救手册","担架使用","更换敷料","感染预防","安全手套","冷敷","热敷","创可贴","消毒膏","消毒剂","胶带","纱布垫","棉球","镊子","剪刀","急救毯","补水","过度劳累","过度换气","惊恐发作","生命体征","血压测量","血氧仪","发烧管理","呼吸困难","哮喘发作","高血糖","低血糖","糖尿病急症","癫痫急救","中风识别","中风管理","紧急号码","快速响应","安全措施","风险评估","旁观者援助","紧急分类","患者稳定","伤员护理","救生技术","环境紧急情况","安全隐患","防护设备","健康紧急情况","关键护理","快速干预","自助技巧","风险预防","安全教育","快速响应","医疗用品","应急准备","灾害响应","安全演练","伤害预防","医疗支持","分诊流程","健康与安全","基本训练","创伤管理","紧急资源","伤害稳定","感染控制","热痉挛","水上安全","道路事故护理","碰撞反应","创伤工具包","夹板技术","绷带方法","伤口闭合","消毒湿巾","止痛药","布洛芬","对乙酰氨基酚","安全护目镜","面罩","撤离计划","紧急撤离","人群控制","防火安全","化学安全","事故预防","急救员","紧急护理","生存技巧","灾害准备","急救","病人护理","急救箱","急救清单","急救认证","呼吸紧急情况","清除气道","海姆立克法","心脏按压","胸外按压","救生呼吸","割伤护理","擦伤","动物咬伤","蚂蚁咬伤","海洋刺伤","水母刺伤","紧急补水","口服补液盐","热紧急情况","低体温处理","冻伤护理","寒冷暴露","电击急救","脊柱保护","头部固定器","颈托","急救毯","分诊训练","急救应用","快速帮助","急救指导","安全信息","自助急救","小伤护理","严重烧伤","感染风险","安全培训","家庭安全","办公室安全","公共安全","紧急场景","救生设备","事故场景","急救指南","药物","医生","治疗","症状","疾病","诊所","药房","疼痛","咳嗽","感冒","流感","感染","过敏","疹子","灼伤","骨折","胃痛","恶心","呕吐","腹泻","便秘","跌倒","青肿","心脏","肝","肾","心理健康","忧郁症","焦虑","疫苗","紧急事件","ಆರೋಗ್ಯ","ಆಸ್ಪತ್ರೆ","ಪ್ರಾಥಮಿಕ ಚಿಕಿತ್ಸೆ","ರಕ್ತಸ್ರಾವ","ನಾನು ಏನು ಮಾಡಲಿ","ನಾನು ಏನು ಮಾಡಬೇಕೆಂದು","ಏನು ಮಾಡಬೇಕು","ಮೈಗ್ರೇನ್","ತಲೆಯ ನೋವು","ರಕ್ತದ ಕಳೆವು","ರಕ್ತ","ತುರ್ತು ಪ್ರತಿಕ್ರಿಯೆ","CPR","ರಕ್ತಸ್ರಾವ ನಿಗ್ರಹ","ಹಚ್ಚು","ಹುರಿದು ಹೋಗುವುದು","ಭಂಗ","ಕಟ","ಘಾವ","ಮೋಚು","ಹಾನಿ","ಪಟ್ಟು","ಆಧಾರ","ಘಾವಗಳನ್ನು ಬಟ್ಟಲು ಹಾಕುವುದು","ಆಘಾತ ಚಿಕಿತ್ಸೆ","ವಿಷಪಾವನ","ಸಾಂಪಿನ ಕಟ","ಕೆಟಕೋಚಿ ಕಟ","ಹರಿತ ಸ್ಥಿತಿಯ ದಾಳ","ಹಿಮರೂಪ ಕಟ್","ಹಿಮಗ್ರಂಥಿ","ಅವರೋದ","ಮೂಢನಂಬಿಕೆ","ಹೃದಯ ನಿಲುಗಡೆ","ಹೃದಯದ ಆಘಾತ","ಪುನರುಜ್ಜೀವನ","ವಾಯುಮಾರ್ಗ ನಿರ್ವಹಣೆ","ಮುಗಿಯುವ ಸ್ಥಿತಿ","ತಲೆ ಗಾಯ","ಕೋಶನಾಳ ಗಾಯ","ಆಲರ್ಜಿ ಪ್ರತಿಕ್ರಿಯೆ","ಅನಾಫಿಲ್ಯಾಕ್ಸಿಸ್","ಮೂಲಭೂತ ಜೀವನ ಬೆಂಬಲ","ಆಟೋಮೇಟೆಡ್ ಎಕ್ಸಟರ್ನಲ್ ಡಿಫಿಬ್ರಿಲ್ಲೇಟರ್","AED","ನಾದನಿರೀಕ್ಷಣೆ","ಶ್ವಾಸ ಪರೀಕ್ಷೆ","ಘಾವ ಶುದ್ಧೀಕರಣ","ಊಷ್ಣನಾಶಕ","ಟೂರ್ನಿಕ್ವೆಟ್","ನಿಷ್ಕ್ರಿಯತೆ","ನೋವು ಪರಿಹಾರ","ಚೋಟ ಚಿಕಿತ್ಸೆ","ಆಘಾತ ಪ್ರತಿಕ್ರಿಯೆ","ಅಪಘಾತ ಚಿಕಿತ್ಸೆ","ಸುರಕ್ಷತಾ ಪ್ರೋಟೋಕಾಲ್","ನೀರರಹಿತ","ಗर्मी ಪ್ರಯೋಗ","ಸೂರ್ಯನ ಹುರಿದು ಹೋಗುವುದು","ಮೂಗುಬಾಲು","ಕಣ್ಣಿನ ಗಾಯ","ಹಲ್ಲಿನ ಗಾಯ","ಜಲಪತನ","ಹುರಿದಾದ ವರ್ಗೀಕರಣ","ರಾಸಾಯನಿಕ ಹುರಿದು ಹೋಗುವುದು","ವಿದ್ಯುತ್ ಹುರಿದು ಹೋಗುವುದು","ಹಲ್ಲು ಹುರಿದು ಹೋಗುವುದು","ಬ್ಲಿಸ್ಟರ್ ಚಿಕಿತ್ಸೆ","ತುರ್ತು ಕಿಟ್","ಪ್ರಾಥಮಿಕ ಚಿಕಿತ್ಸಾ ಕರೆಗೆಡು","ಸ್ಟ್ರೆಚರ್ ಬಳಕೆ","ಬಟ್ಟಲು ಬದಲಾವಣೆ","ಜ್ವರ ನಿರೋಧ","ಸುರಕ್ಷತಾ ಹಿಸ್ತಕವಚ","ತಂಪಾದ ಸಂಕುಚಿತ","ಉಷ್ಣ ಸಂಕುಚಿತ","ಬ್ಯಾಂಡ್-ಏಡ್","ಊಷ್ಣನಾಶಕ ಕ್ರೀಮ್","ವಿಷದ್ರವ್ಯ","ಚಿಪ್ಪು ಟೇಪ್","ಗೋಜ್ ಪ್ಯಾಡ್ಸ್","ಕಾಟನ್ ಬೋಲ್ಸ್","ಟ್ವೀಜರ್ಸ್","ಕತ್ತರಿಸುವ ಕತ್ತರಿ","ತುರ್ತು ಕಂಬಳಿಗಳು","ಹೈಡ್ರೇಷನ್","ಹೆಚ್ಚು ಶ್ರಮ","ಹೈಪರ್ ವೆಂಟಿಲೇಶನ್","ಹತಾಶೆ ದಾಳಿ","ಮೂಲಕ ಚಿಹ್ನೆಗಳು","ರಕ್ತದ ಒತ್ತಡ ಪರಿಶೀಲನೆ","ಪಲ್ಸ್ ಆಕ್ಸಿಮೆಟರ್","ಬುಖಾರದ ನಿರ್ವಹಣೆ","ಶ್ವಾಸಕೋಶ ಸಮಸ್ಯೆಗಳು","ದಮಾಮೈದು","ಹೈಪರ್‌ಗ್ಲೈಸೆಮಿಯಾ","ಹೈಪೋ‌ಗ್ಲೈಸೆಮಿಯಾ","ಮಧುಮೇಹ ತುರ್ತುಗಳು","ಅವರೋಧ ನಿರ್ವಹಣೆ","ಏಪಿಲೆಪ್ಸಿ ಪ್ರಾಥಮಿಕ ಚಿಕಿತ್ಸೆ","ಹಿಟ್ಟಲು ಗುರುತಿಸುವಿಕೆ","ಹಿಟ್ಟಲು ನಿರ್ವಹಣೆ","ತುರ್ತು ಸಂಖ್ಯೆಗಳು","ವೇಗದ ಪ್ರತಿಕ್ರಿಯೆ","ಸುರಕ್ಷತಾ ಕ್ರಮ","ஆரோக்கியம்", "மருத்துவமனை", "முதலுதவி", "இரத்தம் ஓட்டுதல்", "நான் என்ன செய்யவேண்டும்", "நான் என்ன செய்ய வேண்டும்", "என்ன செய்ய வேண்டும்", "மைக்ரேன்", "தலைவலி", "இரத்த அழிவு", "இரத்தம்", "அவசர பதில்", "CPR", "இரத்த ஓட்டத்தை கட்டுப்படுத்துதல்", "கசிவு", "அபாயம்", "முட்டி", "புண்", "சில்பி", "காயங்கள்", "வட்டவட்ட பந்தங்கள்", "சமாசாரம்", "பராமரிப்பு", "இரத்தமேலான பராமரிப்பு", "பிரிவு பராமரிப்பு", "பாதிப்பு", "பிரிவு", "அவசர முடிவுகள்", "மூச்சுவிடுதல்", "காயங்கள்", "தோல்", "நோய்", "விவாதம்", "சிகிச்சை", "நகல்", "தண்டவாளம்", "காயம்", "மருத்துவ குழு", "செய்திகள்", "பிராரம்பம்","ఆరోగ్యం", "ఆసుపత్రి", "మొదటి సాయం", "రక్తప్రవాహం", "నేను ఏమి చేయాలి", "నేను ఏమి చేయాలి", "ఎమిటి చేయాలి", "మైగ్రెయిన్", "తలవేడిత", "రక్త పోత", "రక్తం", "ఆపద ప్రతిస్పందన", "CPR", "రక్త ప్రవాహం నియంత్రణ", "మూచి", "గాయం", "బెత్తం", "ముక్క", "అన్ని పూజాలు", "ముగ్గు", "మునిసిపల్", "ఇఫజరు", "చికిత్స", "సెలవు", "పుష్పం", "గోపురం", "నావు", "తాకిదాడి", "పారిశుధ్యం", "ఆపద సమాచారం", "మంట", "మటుకు","ആരോഗ്യം", "ആശുപത്രി", "ആദ്യചികിത്സ", "രക്തസ്രാവം", "ഞാൻ എന്ത് ചെയ്യണം", "ഞാൻ എന്ത് ചെയ്യണം", "എന്ത് ചെയ്യണം", "മൈഗ്രെയ്ന്", "തലവേദന", "രക്തസ്രാവം", "രക്തം", "അവസര പ്രതികരണം", "CPR", "രക്തസ്രാവം നിയന്ത്രണം", "അപ്‌ഭോഗം", "ഗായം", "പെട്ടി", "ശരി", "പങ്കിടൽ", "ആശുപത്രി", "പകർച്ചവ്യാധി", "ചികിത്സ", "സംവരണം", "ഗാരഞ്ചികിറ്റുകൾ", "ആദ്യചികിത്സ", "സഹായം","मुझे क्या करना चाहिए", "मुझे क्या करना चाहिए", "क्या करना चाहिए", "दुर्घटना","ನಾನು ಏನು ಮಾಡಬೇಕು", "ನಾನು ಏನು ಮಾಡಬೇಕು", "ಏನು ಮಾಡಬೇಕು", "ಆಘಾತ","நான் என்ன செய்ய வேண்டும்", "நான் என்ன செய்ய வேண்டும்", "என்ன செய்ய வேண்டும்", "பாதிப்பு","నేను ఏమి చేయాలి", "నేను ఏమి చేయాలి", "ఎమిటి చేయాలి", "ప్రమాదం","ഞാൻ എന്ത് ചെയ്യണം", "ഞാൻ എന്ത് ചെയ്യണം", "എന്ത് ചെയ്യണം", "ദുരന്തം","मैं क्या करूँ","ವಿಷಪಾನ", "ಹಾವಿನ ಕಚ್ಚು", "ಕೀಟದ ಕಚ್ಚು", "ಹೀಟ್ ಸ್ಟ್ರೋಕ್", "ಫ್ರಾಸ್ಟ್ ಬೈಟ್", "ಹೈಪೋಥರ್ಮಿಯಾ", "ಜಟಕ", "ಭೆದಿಸು", "ಹೃದಯಾಘಾತ", "ಹೃದಯ ರೋಗ","जहर", "साँप का काटना", "कीड़े का काटना", "गर्मी का प्रहार", "तुषारदंश", "हाइपोथर्मिया", "दौरे", "मूर्छा", "हृदय गति रुकना", "दिल का दौरा","விஷம்", "பாம்பு கடி", "பூச்சி கடி", "வெப்ப அழுத்தம்", "உறைப்பு பசை", "உறைப்பு நிலை", "வீக்கம்", "மயக்கம்", "இதய நிறுத்தம்", "இதய aanval","విషప్రయోగం", "పాము కాటు", "పురుగు కాటు", "వడదెబ్బ", "మంచు కాటు", "హైపోథర్మియా", "అల్పవేదన", "అస్వస్థత", "గుండె ఆగడం", "గుండెపోటు","വിഷണം", "പാമ്പുകടിയേറ്റം", "കീടകടിയേറ്റം", "ചൂട് ദേഹാസ്വസ്ഥത", "തണുപ്പ് പിടിച്ചത്", "ഹൈപോതെർമിയ", "കുഴഞ്ഞു വീഴുക", "മൂർച്ച", "ഹൃദയാഘാതം", "ഹൃദയാഘാതം","ನಾನು ಏನು ಮಾಡಬೇಕು?","ಮೂರ್ಛೆ","CPR","cpr"
    ];
    return medicalKeywords.some(keyword => message.toLowerCase().includes(keyword));
};

// Routes
// Chat Route
app.post('/api/chat', async (req, res) => {
    const { message, language } = req.body;

    if (!isMedicalQuery(message)) {
        return res.json({ reply: 'I can only answer medical-related queries.' });
    }

    try {
        const reply = await getFlashLLMResponse(message, language);
        res.json({ reply });
    } catch (error) {
        console.error(error);
        res.status(500).json({ error: 'Error communicating with Flash LLM' });
    }
});

// Hospitals Route
app.post('/api/hospitals', async (req, res) => {
    const { latitude, longitude } = req.body;
    console.log(latitude, longitude);
    try {
        const hospitals = await getNearbyHospitals(latitude, longitude);
        console.log(hospitals);
        res.json(hospitals);
    } catch (error) {
        console.error(error);
        res.status(500).json({ error: 'Error retrieving nearby hospitals' });
    }
});

// Hospital Service Utility
const getNearbyHospitals = async (latitude, longitude) => {
    const config = {
        method: 'get',
        url: `https://api.geoapify.com/v2/places?categories=healthcare.hospital&filter=circle:${longitude},${latitude},5000&apiKey=b92711b9fa4f418bab032ef633748375`,
        headers: {}
    };
    try {
        const response = await axios(config);
        console.log(response.data);
        return response.data;
    } catch (error) {
        console.error(error);
        throw new Error('Error retrieving nearby hospitals');
    }
};

// Error Handling Middleware
app.use((err, req, res, next) => {
    console.error(err);
    res.status(500).json({ error: 'Internal server error' });
});

// Start the server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});